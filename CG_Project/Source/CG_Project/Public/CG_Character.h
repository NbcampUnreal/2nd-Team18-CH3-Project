#pragma once

#include "CoreMinimal.h"
#include "GameFramework/Character.h"
#include "WeaponInterface.h"
#include "StickyGun.h"
#include "HAL/CriticalSection.h"
#include "CG_Character.generated.h"

// 3??? ???? ??????
class USpringArmComponent;

// 3??? ????
class UCameraComponent;


// OverheadWidget?? ???? ???�??

class UWidgetComponent;

// ??? ????
struct FInputActionValue;

//?????? ??
class AStickyGun;

UCLASS()
class CG_PROJECT_API ACG_Character : public ACharacter
{
	GENERATED_BODY()

public:
	ACG_Character();

	// 3??? ???? ??????
	UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "Camera")
	USpringArmComponent* SpringArmComp;

	// 3??? ????
	UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "Camera")
	UCameraComponent* CameraComp;

	// OverheadWidget ????
	UPROPERTY(EditAnywhere, BlueprintReadOnly, Category = "UI")
	UWidgetComponent* OverheadWidget;

	// ??? ???? get???, ??? ???
	UFUNCTION(BlueprintPure, Category = "health")
	float GetHealth() const;
	UFUNCTION(BlueprintCallable, Category = "health")
	void HealHealth(float Amount);

protected:
	// ??? ???, ???? ???
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Health")
	float MaxHealth;
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Health")
	float CurrentHealth;

	// ??? ?????, ???? ?????
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Exp")
	float MaxExp;
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Exp")
	float CurrentExp;

	// ???? ????
	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Level")
	float CurrentLevel;

	virtual void BeginPlay() override;


	virtual void SetupPlayerInputComponent(class UInputComponent* PlayerInputComponent) override;

	//??? ???
	UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Input")
	class UInputAction* FireAction;

	//// ?��???? ???? ??????
	//virtual float TakeDamage();

	//// ?��???? ??? ?????? *???? ??? ?????? ???????
	//virtual float DealDamage();

	// ?��???? ??? ????
	// ????(FInputActionValue&)?? ???????? ?????? ?????? ???????? ??????? ??? ???? ?????
	// ???��???? ????? ????? ???????? ?????? ?��? ?? ?? ????

	UFUNCTION()
	void Move(const FInputActionValue& value);
	UFUNCTION()
	void StartJump(const FInputActionValue& value);
	UFUNCTION()
	void StopJump(const FInputActionValue& value);
	UFUNCTION()
	void Look(const FInputActionValue& value);
	UFUNCTION()
	void StartSprint(const FInputActionValue& value);
	UFUNCTION()
	void StopSprint(const FInputActionValue& value);
	UFUNCTION(BlueprintCallable, Category = "Weapon")
	void Fire();
	UFUNCTION()
	void Roll(const FInputActionValue& value);
	//???? ??? ???
	UFUNCTION(BlueprintCallable, Category = "Weapon")
	void EquipWeapon();



	// ?��???? ???
	void OnDeath();

	// ??? ?? ??��? ????

	void UpdateOverheadHP();

private:
	// ?? ??????
	float NormalSpeed;

	// ????? ??? ????
	float SprintSpeedMultiplier;

	// ????? ???
	float SprintSpeed;
	//?????? ????
	//AStickyGun* EquippedWeapon;
	TScriptInterface<IWeaponInterface> EquippedWeapon;
	
	// StickyGun ?????
	UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Weapon", meta = (AllowPrivateAccess = "true"))
	TSubclassOf<AStickyGun> StickyGunClass;

	// ???, ??? ???? ???? ????
	FCriticalSection MoveInputSection;
	FVector2D MoveInputValue;

	FCriticalSection FireTimeSection;
	
};